{% extends 'base_table_v2.html' %}
{% load static %}
{% block contenido %}
<style>
  .table-vertical-scroll {
    max-height: 50vh;   /* o 400px, ajustá a tu gusto */
    overflow-y: auto;
  }
  .table-vertical-scroll table { margin-bottom: 0; } /* evita espacio extra */
</style>
<title>Ficha Embarque Individual</title>
<link rel="stylesheet" type="text/css" href="{% static 'css/administracion/administracion.css' %}">
<form method="post" id="formFichaEmbarque">
  {% csrf_token %}
  <div class="container-fluid">
    <div class="row">

      <!-- IZQUIERDA: Operativa + Master/House -->
      <div class="col-md-4 border p-3 rounded">
        <label for="id_operativa"><strong>Operativa</strong></label>
        {{ form.operativa }}

        <div class="mt-3">
          <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="tipo_busqueda" id="radio_master" value="master" checked>
            <label class="form-check-label" for="radio_master">Buscar por Master</label>
          </div>
          <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="tipo_busqueda" id="radio_house" value="house">
            <label class="form-check-label" for="radio_house">Buscar por House</label>
          </div>
          <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="tipo_busqueda" id="radio_seguimiento" value="seguimiento">
            <label class="form-check-label" for="radio_seguimiento">Buscar por Seguimiento</label>
          </div>
        </div>

        <div class="mt-2">
          <label for="id_master">Master</label>
          {{ form.master }}
          <label for="id_house" class="mt-2">House</label>
          {{ form.house }}
          <label for="id_seguimiento" class="mt-2">Seguimiento</label>
          {{ form.seguimiento }}

        </div>
      </div>

      <!-- CENTRO: Posición / Documento / Seguimiento -->
      <div class="col-md-4 border p-3 rounded">
        <label for="id_posicion"><strong>Ingrese la posición a buscar</strong></label>
        {{ form.posicion }}



        <div class="form-check mt-3">
          {{ form.detallar_preventas }} <label class="form-check-label" for="id_detallar_preventas">Detallar preventas</label>
        </div>
        <div class="form-check">
          {{ form.expresar_moneda_nac }} <label class="form-check-label" for="id_expresar_moneda_nac">Expresar en moneda nacional</label>
        </div>

        <p class="text-muted mt-2" style="font-size: 0.85rem;">
          <strong>Nota:</strong> Documento cancelado <strong>(*)</strong>, Cancelación parcial <strong>(+)</strong>
        </p>
      </div>

      <!-- DERECHA: Botones -->
      <div class="col-md-4 d-flex flex-column justify-content-start gap-2">
        <button type="submit" class="btn btn-primary btn-block">Buscar</button>
        <button type="submit" name="accion" value="imprimir"
                class="btn btn-danger btn-block"
                {% if not puede_exportar %}disabled{% endif %}>
          Imprimir
        </button>

        <button type="submit" name="accion" value="excel"
                class="btn btn-success btn-block"
                {% if not puede_exportar %}disabled{% endif %}>
          Exportar a Excel
        </button>

      </div>
    </div>
  </div>
</form>

<!-- DATOS DE RESULTADO -->
<div class="container-fluid mt-4 p-3 border rounded bg-light">
  <div class="row mb-2">
    <div class="col-md-3"><strong>Conocimiento:</strong> {{ conocimiento }}</div>
    <div class="col-md-3"><strong>Origen:</strong> {{ origen }}</div>
    <div class="col-md-3"><strong>Destino:</strong> {{ destino }}</div>
    <div class="col-md-3"><strong>Vapor/Viaje:</strong> {{ vapor }} / {{ viaje }}</div>
  </div>
  <div class="row mb-2">
    <div class="col-md-3"><strong>Embarcador:</strong> {{ embarcador }}</div>
    <div class="col-md-3"><strong>Agente:</strong> {{ agente }}</div>
    <div class="col-md-3"><strong>Status:</strong> {{ status }}</div>
    <div class="col-md-3"><strong>Transportista:</strong> {{ transportista }}</div>
  </div>
  <div class="row mb-2">
    <div class="col-md-3"><strong>Interno:</strong> {{ interno }}</div>
    <div class="col-md-3"><strong>Seguimiento:</strong> {{ seguimiento }}</div>
    <div class="col-md-3"><strong>Posicion:</strong> {{ posicion }}</div>
    <div class="col-md-3"><strong>Detalle:</strong> {{ detalle }}</div>
  </div>

  <!-- TABLA DE RESULTADOS -->
  <div class="table-responsive mt-3 table-vertical-scroll">
    <table class="table table-bordered table-sm">
      <thead class="thead-dark">
        <tr>
          <th>Tipo</th>
          <th>Número</th>
          <th>Fecha</th>
          <th>Socio Comercial</th>
          <th>Ingresos</th>
          <th>Egresos</th>
          <th>Detalle</th>
          <th>Moneda</th>
        </tr>
      </thead>
      <tbody>
        {% if resultados and resultados|length > 0 %}
          {% for fila in resultados %}
          <tr>
            <td>{{ fila.tipo }}</td>
            <td>{{ fila.numero }}</td>
            <td>{{ fila.fecha }}</td>
            <td>{{ fila.socio }}</td>
            <td class="text-end">{{ fila.ingresos }}</td>
            <td class="text-end">{{ fila.egresos }}</td>
            <td>{{ fila.detalle }}</td>
            <td>{{ fila.moneda }}</td>
          </tr>
          {% endfor %}
        {% else %}
          <tr>
            <td colspan="8" class="text-center text-muted">
              {{ error_msg|default:"No hay movimientos para mostrar." }}
            </td>
          </tr>
        {% endif %}
      </tbody>

    </table>
  </div>

  <div class="row mt-2">
    <div class="col-md-3"><strong>Total Ingresos:</strong> {{ total_ingresos }}</div>
    <div class="col-md-3"><strong>Total Egresos:</strong> {{ total_egresos }}</div>
    <div class="col-md-3"><strong>Rentabilidad Fiscal:</strong> {{ rentabilidad }}</div>
    {% if detallar_preventas %}
    <div class="col-md-3"><strong>Total Preventa:</strong> {{ total_preventa }}</div>
  {% endif %}
  </div>

</div>

    <script src="{% static 'grilla/ficha_embarque.js' %}"></script>
    <script>
       var csrf_token = '{{ csrf_token }}';
    </script>
{% endblock contenido %}